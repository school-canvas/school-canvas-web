<div class="change-password-container">
  <mat-card class="change-password-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>vpn_key</mat-icon>
        Change Password
      </mat-card-title>
      <mat-card-subtitle>Update your account password</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
        <!-- Current Password -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Current Password</mat-label>
          <input 
            matInput 
            [type]="hideCurrentPassword ? 'password' : 'text'" 
            formControlName="currentPassword" 
            placeholder="Enter your current password"
            autocomplete="current-password">
          <mat-icon matPrefix>lock</mat-icon>
          <button type="button" mat-icon-button matSuffix (click)="hideCurrentPassword = !hideCurrentPassword">
            <mat-icon>{{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="changePasswordForm.get('currentPassword')?.hasError('required')">
            Current password is required
          </mat-error>
          <mat-error *ngIf="changePasswordForm.get('currentPassword')?.hasError('minlength')">
            Password must be at least 6 characters
          </mat-error>
        </mat-form-field>

        <mat-divider class="section-divider"></mat-divider>

        <!-- New Password -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>New Password</mat-label>
          <input 
            matInput 
            [type]="hideNewPassword ? 'password' : 'text'" 
            formControlName="newPassword" 
            placeholder="Enter new password"
            autocomplete="new-password">
          <mat-icon matPrefix>lock_open</mat-icon>
          <button type="button" mat-icon-button matSuffix (click)="hideNewPassword = !hideNewPassword">
            <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="changePasswordForm.get('newPassword')?.hasError('required')">
            New password is required
          </mat-error>
          <mat-error *ngIf="changePasswordForm.get('newPassword')?.hasError('minlength')">
            Password must be at least 8 characters
          </mat-error>
          <mat-error *ngIf="changePasswordForm.get('newPassword')?.hasError('passwordStrength')">
            Password must contain uppercase, lowercase, number, and special character
          </mat-error>
          <mat-error *ngIf="changePasswordForm.hasError('samePassword')">
            New password must be different from current password
          </mat-error>
        </mat-form-field>

        <!-- Password Strength Indicator -->
        <div class="password-strength" *ngIf="changePasswordForm.get('newPassword')?.value">
          <div class="strength-label">Password Strength:</div>
          <div class="strength-bar">
            <div 
              class="strength-fill" 
              [class.weak]="getPasswordStrengthColor() === 'weak'"
              [class.medium]="getPasswordStrengthColor() === 'medium'"
              [class.good]="getPasswordStrengthColor() === 'good'"
              [class.strong]="getPasswordStrengthColor() === 'strong'">
            </div>
          </div>
          <div class="strength-text" [class]="getPasswordStrengthColor()">
            {{ getPasswordStrengthColor() | titlecase }}
          </div>
        </div>

        <!-- Confirm New Password -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirm New Password</mat-label>
          <input 
            matInput 
            [type]="hideConfirmPassword ? 'password' : 'text'" 
            formControlName="confirmPassword" 
            placeholder="Re-enter new password"
            autocomplete="new-password">
          <mat-icon matPrefix>lock_clock</mat-icon>
          <button type="button" mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword">
            <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="changePasswordForm.get('confirmPassword')?.hasError('required')">
            Please confirm your new password
          </mat-error>
          <mat-error *ngIf="changePasswordForm.hasError('passwordMismatch') && changePasswordForm.get('confirmPassword')?.touched">
            Passwords do not match
          </mat-error>
        </mat-form-field>

        <!-- Password Requirements -->
        <mat-card class="requirements-card">
          <mat-card-content>
            <p class="requirements-title">
              <mat-icon class="title-icon">info</mat-icon>
              Password Requirements:
            </p>
            <ul class="requirements-list">
              <li><mat-icon class="req-icon">check_circle</mat-icon> At least 8 characters</li>
              <li><mat-icon class="req-icon">check_circle</mat-icon> One uppercase letter (A-Z)</li>
              <li><mat-icon class="req-icon">check_circle</mat-icon> One lowercase letter (a-z)</li>
              <li><mat-icon class="req-icon">check_circle</mat-icon> One number (0-9)</li>
              <li><mat-icon class="req-icon">check_circle</mat-icon> One special character (!&#64;#$%...)</li>
              <li><mat-icon class="req-icon">block</mat-icon> Different from current password</li>
            </ul>
          </mat-card-content>
        </mat-card>

        <!-- Form Actions -->
        <div class="form-actions">
          <button 
            type="button" 
            mat-stroked-button 
            class="cancel-button"
            (click)="cancel()"
            [disabled]="isLoading">
            <mat-icon>close</mat-icon>
            Cancel
          </button>
          <button 
            type="submit" 
            mat-raised-button 
            color="primary" 
            class="submit-button"
            [disabled]="changePasswordForm.invalid || isLoading">
            <mat-spinner diameter="20" *ngIf="isLoading"></mat-spinner>
            <mat-icon *ngIf="!isLoading">check</mat-icon>
            <span *ngIf="!isLoading">Change Password</span>
          </button>
        </div>
      </form>
    </mat-card-content>

    <!-- Loading Bar -->
    <mat-card-footer *ngIf="isLoading" class="loading-footer">
      <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
    </mat-card-footer>
  </mat-card>
</div>
