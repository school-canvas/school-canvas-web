<h2 mat-dialog-title>
  <mat-icon>payment</mat-icon>
  Record Payment
</h2>

<mat-dialog-content>
  <!-- Invoice Summary -->
  <div class="invoice-summary">
    <h3>Invoice Details</h3>
    <div class="summary-grid">
      <div class="summary-item">
        <span class="label">Invoice Number:</span>
        <span class="value">{{ invoice.invoiceNumber }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Student:</span>
        <span class="value">{{ invoice.studentName }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Total Amount:</span>
        <span class="value">${{ invoice.totalAmount | number:'1.2-2' }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Paid Amount:</span>
        <span class="value paid">${{ invoice.paidAmount || 0 | number:'1.2-2' }}</span>
      </div>
      <div class="summary-item highlight">
        <span class="label">Remaining Balance:</span>
        <span class="value balance">${{ remainingBalance | number:'1.2-2' }}</span>
      </div>
    </div>
  </div>

  <!-- Payment Form -->
  <form [formGroup]="paymentForm" class="payment-form">
    <div class="form-grid">
      <!-- Payment Amount -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Payment Amount</mat-label>
        <span matPrefix>$&nbsp;</span>
        <input 
          matInput 
          type="number" 
          formControlName="amount" 
          placeholder="0.00"
          step="0.01">
        <mat-hint>Maximum: ${{ remainingBalance | number:'1.2-2' }}</mat-hint>
        <mat-error *ngIf="paymentForm.get('amount')?.hasError('required')">
          Amount is required
        </mat-error>
        <mat-error *ngIf="paymentForm.get('amount')?.hasError('min')">
          Amount must be greater than 0
        </mat-error>
        <mat-error *ngIf="paymentForm.get('amount')?.hasError('max')">
          Amount cannot exceed remaining balance
        </mat-error>
      </mat-form-field>

      <!-- Payment Date -->
      <mat-form-field appearance="outline">
        <mat-label>Payment Date</mat-label>
        <mat-icon matPrefix>event</mat-icon>
        <input 
          matInput 
          [matDatepicker]="paymentPicker" 
          formControlName="paymentDate"
          [max]="maxDate"
          placeholder="Select payment date">
        <mat-datepicker-toggle matSuffix [for]="paymentPicker"></mat-datepicker-toggle>
        <mat-datepicker #paymentPicker></mat-datepicker>
        <mat-error *ngIf="paymentForm.get('paymentDate')?.hasError('required')">
          Payment date is required
        </mat-error>
      </mat-form-field>

      <!-- Payment Method -->
      <mat-form-field appearance="outline">
        <mat-label>Payment Method</mat-label>
        <mat-icon matPrefix>account_balance</mat-icon>
        <mat-select formControlName="paymentMethod">
          <mat-option *ngFor="let method of paymentMethods" [value]="method">
            {{ getPaymentMethodLabel(method) }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="paymentForm.get('paymentMethod')?.hasError('required')">
          Payment method is required
        </mat-error>
      </mat-form-field>

      <!-- Transaction ID -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Transaction/Reference ID (Optional)</mat-label>
        <mat-icon matPrefix>tag</mat-icon>
        <input matInput formControlName="transactionId" placeholder="Check number, transaction ID, etc.">
      </mat-form-field>

      <!-- Remarks -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Remarks (Optional)</mat-label>
        <mat-icon matPrefix>note</mat-icon>
        <textarea 
          matInput 
          formControlName="remarks" 
          rows="3" 
          placeholder="Additional notes or comments">
        </textarea>
      </mat-form-field>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="loading">
    Cancel
  </button>
  <button 
    mat-raised-button 
    color="primary" 
    (click)="onSubmit()" 
    [disabled]="!isFormValid">
    <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
    <span *ngIf="!loading">Record Payment</span>
  </button>
</mat-dialog-actions>
